---
import UserEmblem from "$components/UserEmblem.astro"
import playstation from "$images/icons/playstation.svg?raw"
import xbox from "$images/icons/xbox.svg?raw"
import { validateCookie } from "$utils/helpers"

let cookie = validateCookie(Astro.cookies.get("grimoireLogin")?.json())
if (!cookie) Astro.cookies.delete("grimoireLogin")
---

{
	cookie ? (
		<>
			<UserEmblem
				membershipType={cookie.membershipType}
				membershipId={cookie.membershipId}
				username={cookie.username}
			/>
			<a
				href="/logout"
				class="text-slate-400 hover:text-slate-500 text-xs font-medium leading-[28px] text-center transition"
			>
				Changer d'utilisateur
			</a>
		</>
	) : (
		<form action="/login" method="post" class="flex flex-col gap-2">
			<div class="flex gap-1 justify-center">
				<label class="text-slate-400 hover:text-slate-500 transition group-hover:border-slate-400 border-slate-50 border border-r-0 rounded-md px-2 py-1 text-center hover:bg-slate-200 cursor-pointer">
					<input type="checkbox" name="platform" class="peer hidden" />
					<div
						class="inline-block peer-checked:hidden align-text-bottom"
						set:html={playstation}
					/>
					<div
						class="hidden peer-checked:inline-block align-text-bottom"
						set:html={xbox}
					/>
				</label>
				<input
					type="text"
					name="username"
					placeholder="Pseudo"
					autofocus
					required
					class="rounded-md text-base font-medium py-2 px-4 transition focus:outline-none focus:ring-2 ring-slate-400 bg-slate-100 shadow-inner text-slate-500 w-[16ch]"
				/>
			</div>
			<input
				type="submit"
				value="Se connecter"
				class="rounded-md text-slate-400 font-medium py-[10px] px-4 transition bg-slate-200/60 hover:bg-slate-100  cursor-pointer"
			/>
		</form>
	)
}
{
	cookie ? (
		<hr class="w-8 my-4 border-t-2 border-slate-200" />
	) : (
		<p class="text-xs mt-8 text-center text-slate-400">
			Pas de compte sur DestinyÂ ?
		</p>
	)
}
